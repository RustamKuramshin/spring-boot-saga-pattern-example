# Spring Boot Saga Pattern —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Temporal

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Saga —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Temporal –≤ Spring Boot –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ü–∞—Ç—Ç–µ—Ä–Ω Saga –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

### üìÑ –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –¥–æ–∫–ª–∞–¥–∞
[–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è - –°–∞–≥–∞ –æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö](./docs/–°–∞–≥–∞-–æ-–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö.pdf)

## –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

1. **order-service-temporal** - —Å–µ—Ä–≤–∏—Å –∑–∞–∫–∞–∑–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Temporal –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ —Å–∞–≥–∏
2. **mock-services** - –∏–º–∏—Ç–∞—Ü–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (–ø–ª–∞—Ç–µ–∂–∏, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å, –¥–æ—Å—Ç–∞–≤–∫–∞)
3. **mock-service-client** - –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å mock-services
4. **temporal** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Temporal —Å–µ—Ä–≤–µ—Ä–∞

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω Saga —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Temporal –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏. –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö —à–∞–≥–æ–≤:

1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞
2. –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ
3. –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Å–ª—É—á–∞–µ —Å–±–æ—è:

1. –û—Ç–º–µ–Ω–∞ –ø–ª–∞—Ç–µ–∂–∞
2. –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
3. –û—Ç–º–µ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏

Temporal –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —ç—Ç–∏—Ö —à–∞–≥–æ–≤ –∏ –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π, –¥–∞–∂–µ –≤ —Å–ª—É—á–∞–µ —Å–±–æ–µ–≤.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Java 17 –∏–ª–∏ –≤—ã—à–µ
- Docker –∏ Docker Compose
- IntelliJ IDEA

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <url-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è>
cd spring-boot-saga-pattern-example
```

### 2. –ó–∞–ø—É—Å–∫ Temporal —Å–µ—Ä–≤–µ—Ä–∞

```bash
cd temporal
docker-compose -f docker-compose-postgres.yml up -d
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç Temporal —Å–µ—Ä–≤–µ—Ä —Å PostgreSQL –≤ Docker. –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Temporal –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:8088.

### 3. –û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ IntelliJ IDEA

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ IntelliJ IDEA
2. –í—ã–±–µ—Ä–∏—Ç–µ "Open" –∏ —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞
3. –î–æ–∂–¥–∏—Ç–µ—Å—å, –ø–æ–∫–∞ IntelliJ IDEA –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ–µ–∫—Ç –∏ –∑–∞–≥—Ä—É–∑–∏—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### 4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:

#### –ó–∞–ø—É—Å–∫ mock-services

1. –ù–∞–π–¥–∏—Ç–µ –∫–ª–∞—Å—Å `MockServicesApplication` –≤ –ø—Ä–æ–µ–∫—Ç–µ mock-services
2. –©–µ–ª–∫–Ω–∏—Ç–µ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏ –Ω–∞ –∫–ª–∞—Å—Å–µ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ "Run 'MockServicesApplication'"

–°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8085.

#### –ó–∞–ø—É—Å–∫ order-service-temporal

1. –ù–∞–π–¥–∏—Ç–µ –∫–ª–∞—Å—Å `OrderServiceTemporalApplication` –≤ –ø—Ä–æ–µ–∫—Ç–µ order-service-temporal
2. –©–µ–ª–∫–Ω–∏—Ç–µ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏ –Ω–∞ –∫–ª–∞—Å—Å–µ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ "Run 'OrderServiceTemporalApplication'"

–°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8080.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ HTTP-—Ñ–∞–π–ª–æ–≤

–í –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å HTTP-—Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API:

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ order-service

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `order-service-temporal/order.http`
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–µ–ª–µ–Ω—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ —Ä—è–¥–æ–º —Å –∑–∞–ø—Ä–æ—Å–æ–º, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/orders`
3. –≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Temporal

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ mock-services –Ω–∞–ø—Ä—è–º—É—é

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `mock-services/mock.http`
2. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–µ–ª–µ–Ω—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∞–≥–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Temporal –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:8088
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "Workflows"
3. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–π workflow —Å ID, –Ω–∞—á–∏–Ω–∞—é—â–∏–º—Å—è —Å "order-"
4. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ ID, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–µ—Ç–∞–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è workflow

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–º–∏—Ç–∞—Ü–∏–∏ —Å–±–æ–µ–≤

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–º–∏—Ç–∞—Ü–∏—è —Å–±–æ–µ–≤ –æ—Ç–∫–ª—é—á–µ–Ω–∞. –ß—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –µ–µ:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `mock-services/src/main/resources/application.properties`
2. –ò–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ `fault.injection.disabled` –Ω–∞ `false`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ mock-services

–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –∏–º–∏—Ç–∞—Ü–∏–∏ —Å–±–æ–µ–≤, mock-services –±—É–¥—É—Ç —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º:
- –î–æ–±–∞–≤–ª—è—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ –æ—Ç–≤–µ—Ç—ã
- –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ—à–∏–±–∫–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ HTTP-—Å—Ç–∞—Ç—É—Å–∞–º–∏

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —Å–∞–≥–∏ –∫ —Å–±–æ—è–º.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### order-service-temporal

- `OrderController` - REST-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∞–≥–∏
- `OrderWorkflow` - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Temporal workflow
- `OrderWorkflowImpl` - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è workflow —Å –ª–æ–≥–∏–∫–æ–π —Å–∞–≥–∏
- `OrderActivities` - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Temporal activities
- `OrderActivitiesImpl` - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è activities, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã

### mock-services

- `MockController` - REST-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä, –∏–º–∏—Ç–∏—Ä—É—é—â–∏–π –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
- `FaultInjectionService` - —Å–µ—Ä–≤–∏—Å –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —Å–±–æ–µ–≤

### mock-service-client

- `MockServiceClient` - –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤—ã–∑–æ–≤–∞ mock-services
- `MockClientConfiguration` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–î–ª—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ Temporal –ø–æ—Å–µ—Ç–∏—Ç–µ [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Temporal](https://docs.temporal.io/).